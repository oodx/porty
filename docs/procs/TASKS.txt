# Porty Development Tasks - Sprint Planning

## ğŸ¯ Completed Sprints

### âœ… SPRINT 1: RSB Integration & HTTP Dynamic Routing

**SP-001: RSB Framework Migration [13 SP]**
- âœ… Replace Clap with RSB framework
- âœ… Implement dispatch!() and pre_dispatch!() patterns
- âœ… Convert to RSB global context (opt_* variables)
- âœ… Replace println! with echo!() macros
- âœ… Code reduction: main.rs 122 â†’ 27 lines (78% reduction)
- âœ… Built-in commands (help, inspect, stack) working

**SP-002: HTTP Dynamic Routing Core [8 SP]**
- âœ… Wire HTTP handler into net.rs routing logic
- âœ… Add mode parameter to run_route() function
- âœ… Integrate handle_http_connection() for "http" mode routes
- âœ… Update run_porty_server() to pass route.mode
- âœ… Architecture: TCP vs HTTP routing based on config

**SP-003: Module Architecture [5 SP]**
- âœ… Refactor monolithic main.rs into unix-style modules
- âœ… Clean separation: main.rs, args.rs, cfg.rs, net.rs, http.rs
- âœ… Proper imports and exports in lib.rs

**SP-004: RSB Feature Verification [3 SP]**
- âœ… Comprehensive test suite (10 tests in rsb_sanity.rs)
- âœ… Args parsing, global context, config parsing verification
- âœ… All RSB integration tests passing

### âœ… SPRINT 2: Quick Wins & Cleanup [4 SP]

**Completed:**
- âœ… Removed unused PortyArgs struct and args.rs file
- âœ… Converted all println! to RSB echo!()/stderr!() macros
- âœ… Made 'start' the default command (better UX)
- âœ… Fixed all compiler warnings in porty code

---

## âœ… RESOLVED ISSUES

**FIXED: RSB Registry Compilation**
- âœ… Fixed typo in RSB registry.rs that caused compilation errors
- âœ… register_function() now works for inspect command
- âœ… All RSB features functional

---

## ğŸš€ SPRINT 3: Performance & Reliability (Phase 4)

**SP-011: Performance Benchmarking Suite [5 SP]**
- [ ] Create benchmark harness using criterion.rs
- [ ] Measure baseline TCP forwarding performance
- [ ] Benchmark HTTP routing overhead
- [ ] Document performance characteristics
- [ ] Create performance regression tests

**SP-012: Connection Pool Optimization [8 SP]**
- [ ] Implement connection reuse for HTTP mode
- [ ] Add connection pool metrics
- [ ] Configurable pool sizing strategies
- [ ] Health check for pooled connections
- [ ] Connection timeout management

**SP-013: Enhanced Retry Logic [5 SP]**
- [ ] Implement exponential backoff for retries
- [ ] Add jitter to retry delays
- [ ] Configurable retry policies per route
- [ ] Dead letter queue for failed requests
- [ ] Retry metrics and logging

**SP-014: Circuit Breaker Implementation [8 SP]**
- [ ] Implement circuit breaker pattern
- [ ] Configurable failure thresholds
- [ ] Half-open state testing
- [ ] Circuit breaker metrics
- [ ] Integration with health checks

**SP-015: Health Check Endpoints [3 SP]**
- [ ] Add /health endpoint for each route
- [ ] Configurable health check paths
- [ ] Backend health monitoring
- [ ] Health status aggregation
- [ ] Prometheus-compatible metrics endpoint

## ğŸ“‹ BACKLOG (Future Sprint Candidates)

**SP-005: HTTP Dynamic Routing Testing [5 SP]** âœ…
- âœ… Create test config with HTTP mode routes
- âœ… Test ?porty_host=X&porty_port=Y query parameter routing
- âœ… Verify query parameter stripping and clean forwarding
- âœ… End-to-end HTTP proxy testing
- âœ… Production-ready dynamic routing verified

**SP-006: CLI Arguments Global Context [3 SP]** âœ…
- âœ… Test --listen-port, --target-port via RSB global context
- âœ… Verify --verbose, --daemon flags work with opt_* variables
- âœ… Test config file overrides via --config
- âœ… All RSB opt_* variables working perfectly

**SP-007: Default Command Configuration [2 SP]**
- [ ] Configure RSB to default to 'start' command when no args
- [ ] Currently shows help instead of starting server
- [ ] Improve UX for default behavior

**SP-008a: Host Header Routing [3 SP]** âœ…
- âœ… Add optional `host` field to route config
- âœ… Implement Host header matching in http.rs
- âœ… Route requests based on Host header + dynamic routing
- âœ… Test multi-domain routing scenarios

**SP-008b: Enhanced HTTP Logging [2 SP]** âœ…
- âœ… Add detailed request header logging
- âœ… Log response status codes and sizes
- âœ… Configurable log levels for HTTP routes ("none", "basic", "verbose")
- âœ… Performance metrics (response time tracking in ms)

**SP-008c: HTTP Error Handling [3 SP]** âœ…
- âœ… Graceful handling of malformed HTTP requests
- âœ… Timeout handling for slow backends
- âœ… Connection error recovery and retry logic
- âœ… Custom error pages for HTTP routes

**SP-008d: HTTP Cookie Support [3 SP]**
- [ ] Parse and forward cookies from client requests
- [ ] Handle Set-Cookie headers from backend responses
- [ ] Cookie-based session routing (sticky sessions)
- [ ] Cookie modification and injection for routing

**SP-009: Documentation & Examples [5 SP]**
- [ ] Create example configs showcasing HTTP dynamic routing
- [ ] Update README with RSB patterns and features
- [ ] Document query parameter routing usage
- [ ] Performance benchmarking documentation

**SP-010: Production Readiness [8 SP]**
- [ ] Error handling improvements
- [ ] Connection pooling optimization
- [ ] Logging configuration options
- [ ] Daemon mode testing and validation

---

## ğŸ› TECHNICAL DEBT

**TD-001: RSB Documentation Accuracy [1 SP]** âœ…
- âœ… Fixed inflated RSB claims in README
- âœ… Updated actual line counts (156, not 27)
- âœ… Corrected architectural descriptions

**TD-002: Stale Files Cleanup [1 SP]** âœ…
- âœ… Removed porty.log, generate-config, config.toml.bak
- âœ… Moved test TOML files to examples/
- âœ… Cleaned up redundant files

**TD-003: Configuration Documentation [2 SP]**
- [ ] Document 'host' field belongs to Route level, not main config
- [ ] Add examples of Host header vs query parameter routing
- [ ] Clarify TCP vs HTTP mode configuration

---

## ğŸ” RESEARCH & INVESTIGATION

**R-001: RSB Framework Issues [3 SP]**
- [ ] Investigate RSB registry.rs syntax error
- [ ] Determine if dispatch!() auto-registration should work
- [ ] Coordinate with RSB team on fixes

**R-002: Performance Impact [2 SP]**
- [ ] Benchmark RSB vs Clap binary sizes
- [ ] Memory usage comparison
- [ ] Runtime performance analysis

---

## ğŸ“Š Sprint Metrics

**Current Sprint Progress:**
- **Completed**: 34 SP (+5 from SP-005)
- **Blocked**: 0 items (all blockers resolved)
- **Ready for Next Sprint**: 28 SP in backlog

**Key Achievements:**
- 78% code reduction in main.rs while gaining features
- Professional CLI with built-in commands
- Complete HTTP routing architecture
- Comprehensive test coverage

**Critical Path:**
- BLOCKER-001 resolution enables SP-005 testing
- HTTP dynamic routing ready for testing once compilation works
- All architecture changes complete and verified